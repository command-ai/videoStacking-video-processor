generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// This schema is copied from VideoStacking API to maintain compatibility
// Both services share the same database

// ==========================================
// VIDEO PLATFORM MODELS (Relevant for video-processor)
// ==========================================

model Video {
  id             String    @id @default(cuid())
  projectId      String
  scriptId       String?
  mediaIds       String[]  @default([])
  jobId          String?   @unique
  status         String    @default("queued")
  platform       String
  s3Key          String?
  thumbnailS3Key String?
  duration       Float?
  fileSize       BigInt?
  settings       Json?
  metadata       Json?
  error          String?
  processingTime Int?
  createdBy      String
  createdAt      DateTime  @default(now())
  startedAt      DateTime?
  completedAt    DateTime?

  // Dynamic duration fields
  targetDuration      Float?
  actualDuration      Float?
  voiceoverDuration   Float?
  voiceoverStartDelay Float? @default(0.5)
  voiceoverEndDelay   Float? @default(1.0)

  @@index([projectId, status])
  @@index([jobId])
  @@index([createdBy])
  @@map("videos")
}

model VideoMedia {
  id             String   @id @default(cuid())
  projectId      String
  name           String
  type           String
  tags           String[] @default([])
  filename       String
  originalName   String
  mimeType       String
  size           BigInt
  s3Key          String   @unique
  thumbnailS3Key String?
  duration       Float?
  dimensions     Json?
  metadata       Json?
  uploadedBy     String
  createdAt      DateTime @default(now())

  @@index([projectId])
  @@index([uploadedBy])
  @@index([type])
  @@map("video_media")
}

model MusicLibrary {
  id           String   @id @default(cuid())
  name         String
  category     String
  mood         String
  duration     Float
  bpm          Int?
  key          String?
  filename     String
  mimeType     String   @default("audio/mp3")
  fileSize     BigInt
  s3Key        String   @unique
  waveformData Json?
  artist       String?
  album        String?
  copyright    String?
  license      String   @default("royalty-free")
  tags         String[] @default([])
  isActive     Boolean  @default(true)
  isPremium    Boolean  @default(false)
  usageCount   Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([category, isActive])
  @@index([mood])
  @@index([tags])
  @@map("music_library")
}

// Minimal schema - video-processor only needs access to Video, VideoMedia, and MusicLibrary tables
// All other models exist in the shared database but are managed by the API service
